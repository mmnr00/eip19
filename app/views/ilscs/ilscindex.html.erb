<meta name="viewport" content="width=1024">
<ol class="breadcrumb">
  <li class="breadcrumb-item">
    Paparan Admin <b>Program Persediaan Pekerjaan (ILSC)</b></b>
  </li>&nbsp&nbsp
  <%= link_to laporan_path(format: :xlsx, prg: "ILSC"), class: "badge badge-success shadow-sm", style: "font-size: 14px; font-weight: normal" do %>
        <i class="fa fa-sync"></i> Muat Turun Laporan
    <% end %>
</ol>

<%
  crs = {"1"=>"Kursus Jahitan",
          "2"=>"Kursus Bakeri",
          "3"=>"Kursus Pengurusan Pejabat",
          "4"=>"Kursus Teknologi Maklumat (Kegunaan Pejabat)",
          "5"=>"Kursus Kecerdasan Buatan (Artificial Intelligence)",
          "6"=>"Kursus Pembungkusan",
          "7"=>"Kursus Peruncitan",
          "8"=>"Kursus Asas Bakeri",
          "9"=>"Kursus Asas Pengurusan Kafe",
          "10"=>"Kursus Cenderahati (Berasaskan Sukan)",
          "11"=>"Kursus Asas Perkhidmatan Dobi"}

  crsls = []
  crs.each do |k,v|
    crsls << v
  end

%>

<div class="row">
  <div class="col-3" style="margin-bottom: 10px;">
    <div class="card border-left-primary shadow h-100 py-2" >
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">JUMLAH PENDAFTARAN</div>
            <a href=""><div class="h5 mb-0 font-weight-bold text-gray-800"><%= @ilscs.count %></div></a>
          </div>
          <div class="col-auto">
            <i class="fa fa-spinner fa-2x text-gray-300"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%  
    color = ["warning","success","danger","primary"] 
    cnt=0 
    @phs.each do |arr|
  %>
    <div class="col-3" style="margin-bottom: 10px;">
      <div class="card border-left-<%= color[cnt] %> shadow h-100 py-2" >
        <div class="card-body">
          <div class="row no-gutters align-items-center">
            <div class="col mr-2">
              <div class="text-xs font-weight-bold text-<%= color[cnt] %> text-uppercase mb-1"><%= arr.upcase %></div>
              <a href=""><div class="h5 mb-0 font-weight-bold text-gray-800"><%= @ilscs.where(phs: arr).count %></div></a>
            </div>
            <div class="col-auto">
              <i class="fa fa-spinner fa-2x text-gray-300"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% 
    if cnt < 3
      cnt = cnt + 1
    else
      cnt = 0
    end
    end 
  %>
</div>



<%= link_to ilsclistxls_path(format: :xlsx, sch_fld: params[:sch_fld], sch: params[:sch], sch_str: params[:sch_str]), class: "badge badge-info shadow-sm", style: "font-size: 16px; font-weight: normal" do %>
  <i class="fa fa-file-excel"></i> Muat Turun Senarai
<% end %>


<div class="cards shadow mb-4">
  <div class="card-header">
    <div class="row">
      <%= form_tag ilscindex_path, method: :get, id: "find_kid" do %>
        <%= text_field_tag :sch_str, params[:sch_str], placeholder: "Masukkan Nama", style: 'text-transform: uppercase' %>
        <% select_tag :stat, options_for_select(["Permohonan Diterima", "Permohonan Dalam Semakan", "Permohonan Tidak Lengkap","Permohonan Diluluskan", "Permohonan Ditolak"], params[:stat]),
              include_blank: "Semua Status" %>
        <%= select_tag :yr, options_for_select(2020..Date.today.year, params[:yr]),
              include_blank: "Semua Tahun" %>
        <%= hidden_field_tag :sch, params[:sch], value: true %>
        <%= button_tag(type: :submit, class: "badge badge-success shadow-none", style: "font-size: 14px; border-style: none; font-weight: normal",  id: "submit_expense") do %>
            <i class="fa fa-search"></i> Cari
        <% end %>
        <%= link_to ilscindex_path, class: "badge badge-danger shadow-sm", style: "font-size: 14px; font-weight: normal" do %>
            <i class="fa fa-sync"></i> Semula
        <% end %>
        <%= "#{@ilscs.count} carian" %>
      <% end %>
    <div>

        
      </div>
    </div>
  </div>
  <div class="card-body">
    
    <div class="table table-responsive border" style="font-size:13px">
      <%= form_for(:ek, :url => {:controller=>'ilscs', :action=>'statilsc'}, :html => {multipart: true, class: "form-horizontal", method: :post, role: "form"}) do |f| %>
      <table class="table table-bordered table-striped shadow" id="dataTable" width="100%" cellspacing="0" style="color: black">
        
        <thead>
          <tr class="shadow">
            <th style="background-color:#ffb2b2; width: 1%">NO</th>
            <th style="background-color:#ffb2b2; width: 20%">MAKLUMAT PESERTA</th>
            <th style="background-color:#ffb2b2; width: 10%">MAKLUMAT PEMOHON</th>
            <th style="background-color:#ffb2b2; width: 20%">PROGRAM & KURSUS</th>
            <th style="background-color:#ffb2b2; width: 15%">DOKUMEN</th>
            <th style="background-color:#ffb2b2; width: 15%">STATUS</th>
            <th style="background-color:#ffb2b2; width: 5%">TARIKH PERMOHONAN</th>
          </tr>
        </thead>
        <tbody>
          <% cnt =1 ; @ilscs.order('created_at DESC').each do |ek|; perse = ek.perse %>
          <tr>
            <td><%= cnt %></td>
            <td>
              <%= ek.name %><br>
              (<%= ek.ic %>)<br>
              <%
                age = (Date.today.year*12+Date.today.month) - (ek.dobn.year*12+ek.dobn.month)
                yr = age/12
                mth = age - yr*12
        
              %>
              <%= "#{yr} tahun, #{mth} bulan" %><br>
              <a href="<%= ilsc_conf_url(id: ek) %>" target="_blank"><btn class="badge badge-pill badge-secondary">Profil</btn></a>
            </td>
            <td>
              <%= perse.name %><br>
              <%= perse.ph %><br>
              <%= perse.email %><br>
            </td>
            <td>
              <%= ek.tp %><br><br>
              <% ek.crstp.each do |n| %>
                <%= crs[n] %><br>
              <% end %>
                
            </td>
            <td>
              <%
                image = ek.fotos.where(foto_name: "MYKAD BAPA").first
                if image.present? && image.picture.present?
                  url = image.picture.url
                else
                  url = ""
                end
              %>
              <a href="<%= url %>" target="_blank"><btn class="badge badge-pill badge-secondary">MYKAD BAPA</btn></a><br>

              <%
                image = ek.fotos.where(foto_name: "MYKAD IBU").first
                if image.present? && image.picture.present?
                  url = image.picture.url
                else
                  url = ""
                end
              %>
              <a href="<%= url %>" target="_blank"><btn class="badge badge-pill badge-secondary">MYKAD IBU</btn></a><br>

              <%
                image = ek.fotos.where(foto_name: "MYKAD ANAK").first
                if image.present? && image.picture.present?
                  url = image.picture.url
                else
                  url = ""
                end
              %>
              <a href="<%= url %>" target="_blank"><btn class="badge badge-pill badge-secondary">MYKAD ANAK</btn></a><br>

              <%
                image = ek.fotos.where(foto_name: "SLIP UNDI").first
                if image.present? && image.picture.present?
                  url = image.picture.url
                else
                  url = ""
                end
              %>
              <a href="<%= url %>" target="_blank"><btn class="badge badge-pill badge-secondary">SLIP MENGUNDI IBU/BAPA</btn></a><br>

              <%
                image = ek.fotos.where(foto_name: "KAD OKU").first
                if image.present? && image.picture.present?
                  url = image.picture.url
                else
                  url = ""
                end
              %>
              <a href="<%= url %>" target="_blank"><btn class="badge badge-pill badge-secondary">KAD OKU ANAK/DIAGNOSIS</btn></a><br>
              
            </td>

            <td>
              <%= link_to ek.stat, "#", class: "btn btn-block btn-success", style: "margin-bottom: -20px; font-size: 15px"%><br>
              <%= link_to ek.phs, "#", class: "badge badge-pill badge-primary" %><br>
              <b>Maklumat Admin:</b><br>
              <%= ek.descr %><br>
            </td>
            

            <td>
              <%= ek.created_at.strftime('%d-%^b-%y') %>    
            </td>
          </tr>

          <% cnt = cnt + 1;end %> <!-- END LOOP -->

        </tbody>
        
      </table>
      <%= f.submit :"Kemaskini",  class: 'btn btn-sm btn-block btn-success btn-lg', style: "align:center" %>
      <% end %> <!-- END FORM -->
    </div>
  </div>
</div>

