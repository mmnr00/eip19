<div class="container">
  <div class="row">
    <div class="bg-light col-sm-8">
      <h4>NEW BILL CREATION FOR </h4>
      <div class="row">
        <% total_bill = 0 %>
        <div class="col-sm-3">
          <div class="frontside">
            <div class="card">
              <div class='col-lg-12'>
                <%= link_to "#" do %>
                  <span class="pull-right text-success">
                    MAIN BILL<i class=""></i>
                  </span>
                <% end %>
              </div>
              <div class="card-body text-center">
                <p>
                  <% image = @kid.fotos.where(foto_name: "CHILDREN PICTURE").first %>
                  <% if image.present? && image.picture.present? %>
                    <%= image_tag(image.picture.url, size: "50x50") %>
                  <% end %>
                </p>
                <h6 class="card-title"><%= @kid.name.upcase %></h6>
                <p class="card-text">
                  FEE(RM): <%= @kid.classroom.base_fee %>
                  <% total_bill = total_bill + @kid.classroom.base_fee %>
                </p>
                <hr>
                  <% @kid.extras.each do |extra|%>
                  <div class="notice notice-info">
                    <strong><%= extra.name.upcase %></strong><br>RM <%= extra.price %><br><br>
                    <a href="/extras/<%= "#{extra.id}" %>/edit">
                      <span class="text-success">
                         <i class="fa fa-edit"></i> EDIT
                      </span>
                    </a>
                    <a data-confirm="Are you sure" data-method="delete" href="/extras/<%= "#{extra.id}" %>">
                      <span class="pull-right text-danger">
                        DELETE <i class="fa fa-trash"></i>
                      </span>
                    </a>
                  </div>
                <% end %>
                <hr>
                <div class="row">
                  <%= form_for(@kid, :url => {:controller=>'extras', :action=>'add_kid_extras'}, :html => {multipart: true, class: "form-horizontal", method: :get, role: "form"}) do |f| %>
                        <%= f.select :extra_ids, 
                          options_from_collection_for_select(@kid.taska.extras.order('name ASC'), :id, :name),{include_blank: "SELECT EXTRA"} %><br><br>                        
                        <%= f.hidden_field :kid_id, value: @kid.id %>
                        <%= f.hidden_field :child, value: params[:child] %>
                        <%= f.hidden_field :classroom, value: params[:classroom] %>
                        <%= f.hidden_field :month, value: params[:month] %>
                        <%= f.hidden_field :year, value: params[:year] %>
                        <%= f.hidden_field :id, value: params[:id] %>
                        <div style="width: 50%; margin: 0 auto;">
                          <%= f.submit :"ADD",  class: 'btn btn-sm btn-warning btn-lg', style: "align:center" %>
                        </div>
                      <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <% if @kid.beradik.present? %>
          <% @kid.beradik.each do |beradik| %>
            <div class="col-sm-3">
              <div class="frontside">
                <div class="card">
                  <div class='col-lg-12'>
                    <%= link_to remove_siblings_path(id: @taska.id,
                                            child: @kid.id,
                                            classroom: @kid.classroom.id,
                                            month: params[:month],
                                            year: params[:year],
                                            beradik: beradik.id
                                              ), data: {confirm: "Are You Sure?"} do %>
                      <span class="pull-right text-danger">
                        <i class="fa fa-times-circle"></i>
                      </span>
                      <span class="pull-left">
                        <font color="blue">SIBLING</font><i class=""></i>
                      </span>
                    <% end %>
                  </div>
                  <div class="card-body text-center">
                    <p>
                      <% image = beradik.fotos.where(foto_name: "CHILDREN PICTURE").first %>
                      <% if image.present? && image.picture.present? %>
                        <%= image_tag(image.picture.url, size: "50x50") %>
                      <% end %>
                    </p>
                    <h6 class="card-title"><%= beradik.name.upcase %></h6>
                    <p class="card-text">
                      FEE(RM): <%= beradik.classroom.base_fee %>
                      <% total_bill = total_bill + beradik.classroom.base_fee %>
                    </p>
                    <hr>
                      No class enrols
                    <hr>
                    <div class="row">
                      <%= form_for(@kid, :url => {:controller=>'kids', :action=>'add_classroom'}, :html => {multipart: true, class: "form-horizontal", method: :get, role: "form"}) do |f| %>
                        <%= f.select :classroom_id, 
                          options_from_collection_for_select(beradik.taska.extras.order('name ASC'), :id, :name),{include_blank: "SELECT EXTRA"} %><br><br>                        
                        <%= f.hidden_field :kid_id, value: @kid.id %>
                        <div style="width: 50%; margin: 0 auto;">
                          <%= f.submit :"ADD",  class: 'btn btn-sm btn-warning btn-lg', style: "align:center" %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>

      </div>

      <div class='col-sm-12'>
        <%= form_for(@payment, :html => {class: "form-horizontal", role: "form"}) do |f| %>

          <div class="form-group"> 
            <div class="control-label col-sm-4">
              <strong>AMOUNT (RM)</strong>
            </div>
            <div class="col-sm-2">
              <%= f.number_field :amount, rows: 10, class: "form-control", :step => 0.01,placeholder: "e.g 32.10", value: total_bill %>
            </div>
          </div>

          <div class="form-group"> 
            <div class="control-label col-sm-4">
              <strong>BILL DESCRIPTION</strong>
            </div>
            <div class="col-sm-8">
              <%= f.text_area :description, class: "form-control", placeholder: "Max 200 characters", autofocus: true, value: "Bill for month #{$month_name[Date.today.month]} of #{Date.today.year} from #{@taska.name}" %>
            </div>
          </div>
        
          <div class="form-group"> <!-- name -->
            <div class="container">
              <div class="row">
                <div class="control-label col-sm-2">
                 <strong>MONTH</strong>
                  <%= f.text_field :month, class: "form-control", placeholder: "Children Name", autofocus: true, value: params[:month].to_i, readonly: true %>
                </div>
                <div class="control-label col-sm-2">
                 <strong>YEAR</strong>
                  <%= f.text_field :year, class: "form-control", placeholder: "Children Name", autofocus: true, value: params[:year].to_i, readonly: true %>
                </div>
              </div>
            </div>
          </div>
          
          <div>
            <%= f.hidden_field :kid_id, value: @kid.id %>
            <%= f.hidden_field :taska_id, value: @taska.id %>
          </div>

          <div class="form-group">
            <div class="col-sm-offset-0 col-sm-10">
              <%= f.submit :"CREATE BILL", class: 'btn btn-primary btn-m' %>
            </div>
          </div>
        <% end %>
      </div> 
    </div>

    <div align="center" class="col-sm-4">
      <br><br><%= render 'taskas/lookup' %>
    </div>

  </div>
</div>